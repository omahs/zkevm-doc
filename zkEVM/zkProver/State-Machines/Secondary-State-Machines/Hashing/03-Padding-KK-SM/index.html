
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A description of the Padding-KK State Machine.">
      
      
      
        <link rel="canonical" href="https://docs.hermez.io/zkEVM/zkProver/State-Machines/Secondary-State-Machines/Hashing/03-Padding-KK-SM/">
      
      
        <link rel="prev" href="../02-Keccak-Framework/">
      
      
        <link rel="next" href="../04-Padding-KK-Bit-SM/">
      
      <link rel="icon" href="../../../../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.11">
    
    
      
        <title>Padding-KK State Machine - Polygon zkEVM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#padding-kk-state-machine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="Polygon zkEVM Documentation" class="md-header__button md-logo" aria-label="Polygon zkEVM Documentation" data-md-component="logo">
      
  <img src="../../../../../../logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Polygon zkEVM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Padding-KK State Machine
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hermeznetwork/zkevmdoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../Overview/Overview/" class="md-tabs__link md-tabs__link--active">
        Polygon zkEVM
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../Hermez_1.0/about/scalability/" class="md-tabs__link">
        Hermez 1.0
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Polygon zkEVM Documentation" class="md-nav__button md-logo" aria-label="Polygon zkEVM Documentation" data-md-component="logo">
      
  <img src="../../../../../../logo-white.svg" alt="logo">

    </a>
    Polygon zkEVM Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hermeznetwork/zkevmdoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Polygon zkEVM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Polygon zkEVM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Overview/Overview/" class="md-nav__link">
        zkEVM Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
          Basic Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Basic Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Basic-Concepts/Intro-zkProver%27s-Design-Approach/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Basic-Concepts/mFibonnaci-State-Machine-eg/" class="md-nav__link">
        Multiplicative Fibonacci SM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Basic-Concepts/A-Generic-State-Machine/" class="md-nav__link">
        A Generic State Machine
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
          zkProver
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          zkProver
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Overview/zkProver-Overview/" class="md-nav__link">
        zkProver Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2" id="__nav_1_3_2_label" tabindex="0">
          States Machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3_2">
          <span class="md-nav__icon md-icon"></span>
          States Machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Overview/zkProver-State-Machines/" class="md-nav__link">
        State Machines Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2_2" id="__nav_1_3_2_2_label" tabindex="0">
          Secondary State Machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_1_3_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3_2_2">
          <span class="md-nav__icon md-icon"></span>
          Secondary State Machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Arithmetic/Arithmetic/" class="md-nav__link">
        Arithmetic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Storage/Storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2_2_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2_2_3" id="__nav_1_3_2_2_3_label" tabindex="0">
          Hashing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_1_3_2_2_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3_2_2_3">
          <span class="md-nav__icon md-icon"></span>
          Hashing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01-Intro-SMs-for-Hashing/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02-Keccak-Framework/" class="md-nav__link">
        Keccak Framework
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Padding-KK
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Padding-KK
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#padding-and-the-keccak-f-sm" class="md-nav__link">
    Padding And The Keccak-f SM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-strings-and-padding" class="md-nav__link">
    Input Strings And Padding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-main-sm-queries" class="md-nav__link">
    Dealing With Main SM Queries
  </a>
  
    <nav class="md-nav" aria-label="Dealing With Main SM Queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-columns-for-verification-purposes" class="md-nav__link">
    Setting Up Columns For Verification Purposes
  </a>
  
    <nav class="md-nav" aria-label="Setting Up Columns For Verification Purposes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-padding-check-using-columns" class="md-nav__link">
    Example 1. Padding Check Using Columns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-description-of-state-transitions-in-pil" class="md-nav__link">
    Step-by-step Description Of State Transitions in PIL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash-output-check" class="md-nav__link">
    Hash Output Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#length-and-read-check-operations" class="md-nav__link">
    Length And Read Check Operations
  </a>
  
    <nav class="md-nav" aria-label="Length And Read Check Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#length-check" class="md-nav__link">
    Length Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-check" class="md-nav__link">
    Read Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-read-check-using-columns" class="md-nav__link">
    Example 2. Read Check Using Columns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-read-operation-and-the-main-state-machine" class="md-nav__link">
    The Read Operation And The Main State Machine
  </a>
  
    <nav class="md-nav" aria-label="The Read Operation And The Main State Machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-3-main-sm-and-padding-kk-connection" class="md-nav__link">
    Example 3. Main SM and Padding-KK Connection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04-Padding-KK-Bit-SM/" class="md-nav__link">
        Padding-KK-Bit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05-Bits2Field-SM/" class="md-nav__link">
        Bits2Field
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06-KECCAK-f-sm/" class="md-nav__link">
        Keccak-f
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../07-Poseidon-sm/" class="md-nav__link">
        Poseidon
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Binary/Binary/" class="md-nav__link">
        Binary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory/Memory/" class="md-nav__link">
        Memory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory-Align/Memory-Align/" class="md-nav__link">
        Memory Align
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Complementary/Complementary/" class="md-nav__link">
        Complementary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Complementary/Configuration-File/" class="md-nav__link">
        Configuration File
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
      
      
      
        <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
          zk Tooling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          zk Tooling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1_4_1" id="__nav_1_4_1_label" tabindex="0">
          zkASM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_4_1">
          <span class="md-nav__icon md-icon"></span>
          zkASM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Basic-Syntax/" class="md-nav__link">
        Basic Syntax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Some-Examples/" class="md-nav__link">
        Some Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Related-Repos/" class="md-nav__link">
        Related Repositories
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_4_2" id="__nav_1_4_2_label" tabindex="0">
          PIL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_4_2">
          <span class="md-nav__icon md-icon"></span>
          PIL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Hello-World-Examples/" class="md-nav__link">
        Hello Word Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Components/" class="md-nav__link">
        Components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Cyclical-Nature/" class="md-nav__link">
        Cyclical Nature
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Modularity/" class="md-nav__link">
        Modularity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Advanced-Features/" class="md-nav__link">
        Advanced Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Related-Repos/" class="md-nav__link">
        Related Repositories
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
      
      
      
        <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
          zkEVM Implementation How To(s)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          zkEVM Implementation How To(s)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Building-on-Polygon-zkEVM-H_io/" class="md-nav__link">
        Building on Polygon zkEVM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../How-To-Run-A-zkNode/" class="md-nav__link">
        How To Run A Local zkNode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Setting-Up-Production-zkNode/" class="md-nav__link">
        Setting Up Production zkNode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Polygon-zkEVM-Source-Code/" class="md-nav__link">
        Polygon zkEVM Source Code
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Hermez 1.0
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Hermez 1.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/scalability/" class="md-nav__link">
        Ethereum Scalability and zk-Rollups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/value-proposition/" class="md-nav__link">
        Hermez Value Proposition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/model/" class="md-nav__link">
        Hermez Network Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Users
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/hermez-wallet/" class="md-nav__link">
        Hermez Wallet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/mainnet/" class="md-nav__link">
        Hermez Mainnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/testnet/" class="md-nav__link">
        Hermez Testnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/exchanges/" class="md-nav__link">
        Exchanges
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/dev-guide/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
          Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3_2">
          <span class="md-nav__icon md-icon"></span>
          Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3_2_1" id="__nav_2_3_2_1_label" tabindex="0">
          Hermez zkRollup protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          Hermez zkRollup protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/hermez-protocol/protocol/" class="md-nav__link">
        Core protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/hermez-protocol/contracts/contracts/" class="md-nav__link">
        Smart contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/hermez-protocol/circuits/circuits/" class="md-nav__link">
        Circuits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/consensus/consensus/" class="md-nav__link">
        Forging consensus protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/withdrawal-delayer/withdrawal-delayer/" class="md-nav__link">
        Withdrawal delayer protocol
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/sdk/" class="md-nav__link">
        Examples/SDK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/api/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/batch-explorer/" class="md-nav__link">
        Batch Explorer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/price-updater/" class="md-nav__link">
        Hermez NodePrice Updater
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          FAQ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          FAQ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/end-users/" class="md-nav__link">
        End-Users
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/integrators/" class="md-nav__link">
        Integrators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/coordinators/" class="md-nav__link">
        Coordinators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/pod/" class="md-nav__link">
        Proof of Donation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/other/" class="md-nav__link">
        Other
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#padding-and-the-keccak-f-sm" class="md-nav__link">
    Padding And The Keccak-f SM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-strings-and-padding" class="md-nav__link">
    Input Strings And Padding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-main-sm-queries" class="md-nav__link">
    Dealing With Main SM Queries
  </a>
  
    <nav class="md-nav" aria-label="Dealing With Main SM Queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-columns-for-verification-purposes" class="md-nav__link">
    Setting Up Columns For Verification Purposes
  </a>
  
    <nav class="md-nav" aria-label="Setting Up Columns For Verification Purposes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-padding-check-using-columns" class="md-nav__link">
    Example 1. Padding Check Using Columns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-description-of-state-transitions-in-pil" class="md-nav__link">
    Step-by-step Description Of State Transitions in PIL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash-output-check" class="md-nav__link">
    Hash Output Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#length-and-read-check-operations" class="md-nav__link">
    Length And Read Check Operations
  </a>
  
    <nav class="md-nav" aria-label="Length And Read Check Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#length-check" class="md-nav__link">
    Length Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-check" class="md-nav__link">
    Read Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-read-check-using-columns" class="md-nav__link">
    Example 2. Read Check Using Columns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-read-operation-and-the-main-state-machine" class="md-nav__link">
    The Read Operation And The Main State Machine
  </a>
  
    <nav class="md-nav" aria-label="The Read Operation And The Main State Machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-3-main-sm-and-padding-kk-connection" class="md-nav__link">
    Example 3. Main SM and Padding-KK Connection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="padding-kk-state-machine">Padding-KK State Machine</h1>
<p>The Padding-KK state machine serves as the gateway to all Keccak-related state machines. It is therefore responsible for handling queries from the Main state machine. The common queries are requests for digests of messages, together with validation of these digests.</p>
<p>This document presents an explanation of how the Padding-KK SM operates. How it checks that padding rules are adhered to, as well as validating correctness of hash values, lengths of input strings, and that input strings are properly read.</p>
<p>Firstly, note that operations of the Padding-KK SM are byte-wise based, while the Keccak-f SM's operations are bit-wise based. The Padding-KK-Bit SM takes care of this disparity in string formats.</p>
<h2 id="padding-and-the-keccak-f-sm">Padding And The Keccak-f SM</h2>
<p>Although the hashing of messages is carried out by the Keccak-f SM, the padding happens in the Padding-KK SM. Messages are presented to the Padding-KK SM as byte-strings in hexadecimal form. But the Padding-KK-Bit SM ensures that these are presented as bit-strings to the Keccak-f SM.</p>
<p>Even though Keccak-f SM receives strings of any length as inputs, each input-message to the Keccak-f SM is first split into blocks of 1088 bits (i.e., 136 bytes), called the bit rate (or rate). If the tail-end of the splits is shorter than 136 bytes, or if the original message is shorter than 136 bytes, a specific string is appended to it in order to form a full 136-byte string. The appended bits (or bytes) are referred to as the <strong>padding</strong>.</p>
<p>Keccak's first padding-rule is to append the string <span class="arithmatex">\(\mathtt{100^*1}\)</span> of the appropriate length. That is, the padding always consists of two 1's and a string of 0's between them.</p>
<p>The second padding rule: If the input-message is exactly 136 bytes long, or a multiple of 136 bytes, then a block of 136 bytes consisting of just the padding <span class="arithmatex">\(\mathtt{100^*1}\)</span>, must be appended.</p>
<p>It is crucial to emphasise that the Polygon zkEVM follows the Keccak construction used in the Ethereum. So then the Padding-KK SM does not append any other 'fixed' bits to the padding, such as appending "<span class="arithmatex">\(\mathtt{01}\)</span>" as it is done in the FIPS's SHA-3. Therefore, as far as the Keccak-f hash function is concerned, the Polygon zkEVM does not follow the FIPS.202 Standard.</p>
<h2 id="input-strings-and-padding">Input Strings And Padding</h2>
<p>Consider the strings <span class="arithmatex">\(\mathtt{s_1, s_2, \dots , s_n}\)</span> that need to be hashed.</p>
<p>Note that the bits (or bytes) of these strings cannot be simply combined and presented as one stream of bits (or bytes) as though they belong to one long string. But each string <span class="arithmatex">\(\mathtt{s_i}\)</span> need to be treated as an individual string, and thus must first be separately padded in line with the above-mentioned padding rules. Only thereafter, depending on the SM involved, can the bytes or the bits be fed into the relevant SM. </p>
<p>The idea here is to map each string to one or several blocks of 136 bytes (1088 bits), and include the proper padding at the tail-end part. See Figure below.</p>
<p><img alt="Schema of input strings allocation in Keccak" src="../figures/01pkk-input-strings-allocate.png" /></p>
<div align="center"><b> Figure 1 : Schema of input strings allocation in Keccak </b></div>

<p>Observe that, as shown in the first string in the Figure above; Whenever the length of a certain string is a multiple of the block length of 136 bytes, a new block containing only the padding must be appended. Once this is done, the new resulting string can be provided to the Keccak-f SM for hashing. </p>
<h2 id="dealing-with-main-sm-queries">Dealing With Main SM Queries</h2>
<p>The Padding-KK SM is in charge of validating that the padding rule is correctly performed, as well as validating each of the prescribed operations;</p>
<ol>
<li>Validate the lengths of given strings <span class="arithmatex">\(\{\mathtt{s_i}\}\)</span>. (i.e., <strong>length check</strong>),</li>
<li>Validate the hashes of certain strings <span class="arithmatex">\(\{\mathtt{s_i}\}\)</span>. (i.e., <strong>digest check</strong>), </li>
<li>Validate reads from 1 to 32 bytes of string <span class="arithmatex">\(\mathtt{s_i}\)</span>. (i.e., <strong>read check</strong>).</li>
</ol>
<p>Next is to prepare the machinery that will enable the Padding-KK SM achieve these three checks. </p>
<h3 id="setting-up-columns-for-verification-purposes">Setting Up Columns For Verification Purposes</h3>
<p>We now design a series of columns that will enable us to completely verify correctness of every state transitions.</p>
<ul>
<li><span class="arithmatex">\(\texttt{freeIn}\)</span>: This register will store every byte of the padded input (as commented before), one byte per row.</li>
<li>
<p><span class="arithmatex">\(\texttt{address}\)</span>: This register will store an increasing sequence of integers starting from 0, changing its value at the beginning of a new string. Of course, an address completely determines the corresponding string of a certain byte.</p>
</li>
<li>
<p><span class="arithmatex">\(\texttt{connected}\)</span>: This register represents the connection between two blocks. If <span class="arithmatex">\(\texttt{connected}\)</span> is 1, the actual block is in the same string with the previous block. Otherwise, the last block is in the previous string.</p>
</li>
<li>
<p><span class="arithmatex">\(\texttt{lastBlock}\)</span>: This register flags the last row of every block. If <span class="arithmatex">\(\texttt{lastBlock}\)</span> is 1, the next block will start in the next row of the table.</p>
</li>
<li>
<p><span class="arithmatex">\(\texttt{rem}\)</span>: For each string, this register is a decreasing sequence of signed integers. Starting at the length of the current string and it keeps decreasing until the last block of the string is reached. Observe that this value can be negative since a padding may be present in the string. (<span class="arithmatex">\(\texttt{rem}\)</span> is short for 'remaining'.)</p>
</li>
<li>
<p><span class="arithmatex">\(\texttt{len}\)</span>: For each string, this register stores original length (i.e., the length of the string before padding was appended). Therefore, this register remains constant for all rows of each string. Observe that, at the first row of each string, <span class="arithmatex">\(\texttt{len}\)</span> coincides with <span class="arithmatex">\(\texttt{rem}\)</span>.</p>
</li>
<li>
<p><span class="arithmatex">\(\texttt{remIsZero}\)</span>: A computed register which is 1 whenever <span class="arithmatex">\(\texttt{rem}\)</span> is zero, and 0 otherwise.</p>
</li>
<li>
<p><span class="arithmatex">\(\texttt{spare}\)</span>: The <span class="arithmatex">\(\texttt{spare}\)</span> register is 1 just after the byte <span class="arithmatex">\(\texttt{0x01}\)</span>, corresponding to the appearance of padding bits. Observe that it can happen that <span class="arithmatex">\(\texttt{spare}\)</span> is constantly 0 among a full string. This is because we can have the situation where the padding only consists of the byte <span class="arithmatex">\(\texttt{0x81}\)</span>.</p>
</li>
<li>
<p><span class="arithmatex">\(\texttt{lastHash}\)</span>: This register is actually computed from the registers <span class="arithmatex">\(\texttt{spare}\)</span>, <span class="arithmatex">\(\texttt{remIsZero}\)</span> and <span class="arithmatex">\(\texttt{lastBlock}\)</span> as follows,
  $$
  \texttt{lastHash = lastBlock · (spare + remIsZero)} \tag{Eqn.1}
  $$
  This means <span class="arithmatex">\(\texttt{lastHash}\)</span> will be 1 whenever two things hold true; First, if <span class="arithmatex">\(\texttt{lastBlock} = 1\)</span>, and secondly, if the next block to be processed is contained in the next string. </p>
</li>
</ul>
<p>Observe that <span class="arithmatex">\(\texttt{spare}\)</span> and <span class="arithmatex">\(\texttt{remIsZero}\)</span> cannot simultaneously be "1" (i.e., not in the same row). Moreover, it is very important to include <span class="arithmatex">\(\texttt{remIsZero}\)</span> in this computation because <span class="arithmatex">\(\texttt{spare}\)</span> alone cannot help detect that padding has occurred. For instance, if <span class="arithmatex">\(\mathtt{pad = 0x81}\)</span>, then <span class="arithmatex">\(\texttt{spare}\)</span> would remain constant, continuing to record 0's as if no padding took place.</p>
<h4 id="example-1-padding-check-using-columns">Example 1. Padding Check Using Columns</h4>
<p>Let us illustrate this design with a table, using the columns defined above. Suppose the following strings have been padded and are ready for hashing;
$$
\mathtt{s_0 = 8000\dots 00016f6c6c6568}\text{ } \text{ } \text{ } \text{ }\text{ }\text{ }\text{ } \
\mathtt{s_1 = 8000012f\dots 11|616c\dots 6966}
$$
where "|" indicates the end of a 136-byte block. In the below table, these 136-byte splits between blocks are indicated with a horizontal line.</p>
<div align="center"><b> Table 1 : Padding Check And Columns Design Example </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|}
\hline
\texttt{freeIn} &amp; \texttt{addr} &amp; \texttt{connected} &amp; \texttt{lastBlock} &amp; \texttt{rem} &amp; \texttt{len} &amp; \texttt{remIsZero} &amp; \texttt{spare} &amp; \texttt{lastHash} \\ \hline 
\mathtt{0x68} &amp; 0 &amp; 0 &amp; 0 &amp; 5 &amp; 5 &amp; 0 &amp; 0 &amp; 0 \\ 
\mathtt{0x65} &amp; 0 &amp; 0 &amp; 0 &amp; 4 &amp; 5 &amp; 0 &amp; 0 &amp; 0 \\ 
\mathtt{0x6c} &amp; 0 &amp; 0 &amp; 0 &amp; 3 &amp; 5 &amp; 0 &amp; 0 &amp; 0 \\ 
\mathtt{0x6c} &amp; 0 &amp; 0 &amp; 0 &amp; 2 &amp; 5 &amp; 0 &amp; 0 &amp; 0 \\ 
\mathtt{0x6f} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 5 &amp; 0 &amp; 0 &amp; 0 \\
\mathtt{0x01} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 5 &amp; 1 &amp; 0 &amp; 0 \\
\mathtt{0x00} &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; 5 &amp; 0 &amp; 1 &amp; 0 \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
\mathtt{0x00} &amp; 0 &amp; 0 &amp; 0 &amp; -129 &amp; 5 &amp; 0 &amp; 1 &amp; 0 \\
\mathtt{0x80} &amp; 0 &amp; 0 &amp; 1 &amp; -130 &amp; 5 &amp; 0 &amp; 1 &amp; 1 \\
\hline
\mathtt{0x66} &amp; 1 &amp; 0 &amp; 0 &amp; 269 &amp; 269 &amp; 0 &amp; 0 &amp; 0 \\
\mathtt{0x69} &amp; 1 &amp; 0 &amp; 0 &amp; 268 &amp; 269 &amp; 0 &amp; 0 &amp; 0 \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
\mathtt{0x6c} &amp; 1 &amp; 0 &amp; 0 &amp; 135 &amp; 269 &amp; 0 &amp; 0 &amp; 0 \\
\mathtt{0x61} &amp; 1 &amp; 0 &amp; 1 &amp; 134 &amp; 269 &amp; 0 &amp; 0 &amp; 0 \\
\hline
\mathtt{0x11} &amp; 1 &amp; 1 &amp; 0 &amp; 133 &amp; 269 &amp; 0 &amp; 0 &amp; 0 \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
\mathtt{0x2f} &amp; 1 &amp; 1 &amp; 0 &amp; 1 &amp; 269 &amp; 0 &amp; 0 &amp; 0 \\
\mathtt{0x01} &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 269 &amp; 1 &amp; 0 &amp; 0 \\
\mathtt{0x00} &amp; 1 &amp; 1 &amp; 0 &amp; -1 &amp; 269 &amp; 0 &amp; 1 &amp; 0 \\
\mathtt{0x80} &amp; 1 &amp; 1 &amp; 1 &amp; -2 &amp; 269 &amp; 0 &amp; 1 &amp; 1 \\ \hline
\end{array}
\]</div>
<p>The above table illustrates how the columns can be used to record the executional trace of the Padding-KK State Machine. As it is our general approach, a strategy towards achieving verifiable computations, the next task is to describe the state transitions of the Padding-KK SM in terms of polynomials.</p>
<h3 id="step-by-step-description-of-state-transitions-in-pil">Step-by-step Description Of State Transitions in PIL</h3>
<p>By capturing the relationships between and among the columns (registers defined above) in terms of equations, amounts to translating the execution of the padding into a verification code written in PIL.</p>
<p><span class="arithmatex">\(\bf{(a)}\)</span>  In order to guarantee that the value recorded in the <span class="arithmatex">\(\texttt{rem}\)</span> register decreases until <span class="arithmatex">\(\texttt{lastHash}\)</span> is 1 (that is, the end of the string), use the relation,
$$
\mathtt{rem}'\cdot \mathtt{(1 - lastHash)\ = (rem - 1)(1 - lastHash)} \tag{Eqn.2}
$$</p>
<p><span class="arithmatex">\(\bf{(b)}\)</span>  How can we validate the fact that <span class="arithmatex">\(\texttt{spare}\)</span> was constructed as expected? </p>
<p>First observe that <span class="arithmatex">\(\texttt{spare}\)</span> changes to 1 immediately after a 1 was recorded in the <span class="arithmatex">\(\texttt{remIsZero}\)</span> register. (i.e., Immediately when the padding starts, and when <span class="arithmatex">\(\mathtt{pad} \not= 0x81\)</span>.)</p>
<p>Secondly, notice that after this point, <span class="arithmatex">\(\texttt{spare}\)</span> remains 1 until (and including when) <span class="arithmatex">\(\texttt{lastHash}\)</span> equals 1. After which, <span class="arithmatex">\(\texttt{spare}\)</span> becomes 0. </p>
<p>Hence, these behaviour can be captured as,
$$
\texttt{spare}' \mathtt{ = (spare + remIsZero)\cdot (1 - lastHash)} \tag{Eqn.3}
$$</p>
<p><span class="arithmatex">\(\bf{(c)}\)</span>  Verifying correctness of the <span class="arithmatex">\(\texttt{connected}\)</span> register requires two constraints;</p>
<p>​       (i) Checking that <span class="arithmatex">\(\texttt{connected}\)</span> is constant in each block
$$
\mathtt{connected'}\cdot \mathtt{(1 - lastBlock) = connected \cdot (1 - lastBlock)}  \tag{Eqn.4}
$$
​       (ii) Checking two specific situations,</p>
<p>​           Firstly, when <span class="arithmatex">\(\mathtt{lastBlock}\)</span> is 1 and <span class="arithmatex">\(\mathtt{lastHash}\)</span> is 0. In which case the next value of <span class="arithmatex">\(\texttt{connected}\)</span> should be 0, because of the block change but within the same string.</p>
<p>​           Secondly, when both <span class="arithmatex">\(\mathtt{lastBlock}\)</span> and <span class="arithmatex">\(\mathtt{lastHash}\)</span> are 1. In which case the next value of <span class="arithmatex">\(\texttt{connected}\)</span> should be 0, due to the string change.</p>
<p>These two scenarios are verified with the following constraint,
$$
\mathtt{connected' \cdot lastBlock = ( 1 - lastHash) \cdot lastBlock} \tag{Eqn.5}
$$</p>
<p><span class="arithmatex">\(\bf{(d)}\)</span>  The <span class="arithmatex">\(\mathtt{len}\)</span> register is constant within each string. It must therefore satisfy this relationship,
$$
\mathtt{ len'\cdot firstHash = len\cdot (1 - lastHash)} \tag{Eqn.6}
$$</p>
<p><span class="arithmatex">\(\bf{(e)}\)</span>  Checking that <span class="arithmatex">\(\mathtt{len}\)</span> and <span class="arithmatex">\(\mathtt{rem}\)</span> coincide at the first state of each string, use the constraint, 
$$
\mathtt{len \cdot firstHash = rem\cdot firstHash} \tag{Eqn.7}
$$
​       where <span class="arithmatex">\(\mathtt{firstHash}\)</span> is a committed column and it is such that <span class="arithmatex">\(\mathtt{firstHash' = lastHash}\)</span>.</p>
<p>In fact, <span class="arithmatex">\(\mathtt{firstHash}\)</span> is a shifted version of <span class="arithmatex">\(\mathtt{lastHash}\)</span>, which is used to ensure that, when starting a</p>
<p>string (and therefore, <span class="arithmatex">\(\mathtt{firstHash = 1}\)</span>), then <span class="arithmatex">\(\mathtt{len = rem}\)</span>.</p>
<div align="center"><b> Table 2 : Comparison Between 'lastHash' and 'firstHash' </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|}
\hline
\texttt{lastHash} &amp; \texttt{firstHash}\\ \hline
\text{ }\text{ } \text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 0 \\
\text{ }\text{ }\text{ }\text{ }\text{ }\cdots &amp; \cdots\\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }0 &amp; 0 \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }0 &amp; 0 \\
\text{ }\text{ }\text{ }\text{ }\text{ }\cdots &amp; \cdots\\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }1 &amp; 0 \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }0 &amp; 1 \\
\text{  }\text{ }\text{ }\text{  }\text{ }\text{} \cdots &amp; \cdots\\ \hline
\end{array}
\]</div>
<p><span class="arithmatex">\(\bf{(f)}\)</span>​ Let us now specify the relations that satisfy the <span class="arithmatex">\(\mathtt{addr}\)</span> register. As commented on before, <span class="arithmatex">\(\mathtt{addr}\)</span> is constant within each string. Hence, <span class="arithmatex">\(\mathtt{(addr' - addr) = 0}\)</span>  if and only if  <span class="arithmatex">\(\mathtt{1 - lastHash \not= 0}\)</span>. </p>
<p>The constraint for the <span class="arithmatex">\(\mathtt{addr}\)</span> register is therefore
$$
\mathtt{(addr' - addr) \cdot (1 - lastHash)  = 0}\tag{Eqn.8}
$$
Note that going from one string to the next, the values of the <span class="arithmatex">\(\mathtt{addr}\)</span> register form an increasing sequence (increasing by steps of 1 from one string to the next). </p>
<p>However, since the polynomials utilised in this scheme are all cyclic (due to evaluations on roots of unity), there is a need to ensure that the <span class="arithmatex">\(\mathtt{addr}\)</span> register resets to <span class="arithmatex">\(0\)</span> whenever the reading returns to the first row.</p>
<p>For this purpose, a register called <span class="arithmatex">\(\mathtt{lastBlockLatch}\)</span> is added. And <span class="arithmatex">\(\mathtt{lastBlockLatch}\)</span> is 1, if <span class="arithmatex">\(\mathtt{lastBlock}\)</span> is 1 and the string, that the last block belongs to, is not the last one.</p>
<p>Similarly, another register called <span class="arithmatex">\(\mathtt{lastHashLatch}\)</span> is added, and it is defined such that 
$$
\mathtt{ lastHashLatch = lastBlockLatch \cdot (spare + remIsZero) } \tag{Eqn.9}
$$
See Table 3 below, for a comparison between the <span class="arithmatex">\(\texttt{latch}\)</span> and non-<span class="arithmatex">\(\mathtt{latch}\)</span> registers.  </p>
<div align="center"><b> Table 3 : Comparison Between Latch and non-Latch registers </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|}
\hline
\texttt{lastBlock} &amp; \texttt{lastBlockLatch} &amp; \texttt{lastHash} &amp; \texttt{lastHashLatch}\\ \hline
\text{ }\text{ } \text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 0 &amp; 0 &amp; 0 \\
\text{ }\text{ }\text{ }\text{ }\text{ }\cdots &amp; \cdots &amp; \cdots &amp; \cdots\\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; 1 &amp; 0 &amp; 0 \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 0 &amp; 0 &amp; 0 \\
\text{ }\text{ }\text{ }\text{ }\text{ }\cdots &amp; \cdots &amp; \cdots &amp; \cdots\\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; 1 &amp; 1 &amp; 1 \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 0 &amp; 0 &amp; 0  \\
\text{  }\text{ }\text{ }\text{  }\text{ }\text{} \cdots &amp; \cdots &amp; \cdots &amp; \cdots\\
\text{  }\text{ }\text{ }\text{  }\text{ }\text{} \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; 0 &amp; 1 &amp; 0  \\\hline
\end{array}
\]</div>
<p><span class="arithmatex">\(\bf{(g)}\)</span>  In order to grapple with the increasing but cyclic sequence of <span class="arithmatex">\(\mathtt{addr}\)</span>, the following constraint is used, 
$$
\mathtt{ ( addr' - 1 - addr)\cdot lastHashLatch = 0} \tag{Eqn.10}
$$</p>
<p><span class="arithmatex">\(\bf{(h)}\)</span>  Now, checking whether <span class="arithmatex">\(\mathtt{remIsZero}\)</span> is 1 if and only if <span class="arithmatex">\(\mathtt{rem}\)</span> is 0, is done reversely by first committing the column <span class="arithmatex">\(\mathtt{remInv}\)</span>, the inverse of <span class="arithmatex">\(\mathtt{rem}\)</span>, and computing <span class="arithmatex">\(\mathtt{remIsZero}\)</span> as
$$
\mathtt{remIsZero = 1 − rem · remInv} \tag{Eqn.11}
$$
And then, as usual, check the relation, <span class="arithmatex">\(\mathtt{remIsZero \cdot rem = 0}\)</span>.</p>
<p><span class="arithmatex">\(\bf{(i)}\)</span>  Next is the <span class="arithmatex">\(\mathtt{aFreeIn}\)</span> register which stores the input byte if and only if the current row does not corresponding to the padding. <span class="arithmatex">\(\mathtt{aFreeIn}\)</span> is computed from the <span class="arithmatex">\(\mathtt{remIsZero}\)</span>, <span class="arithmatex">\(\mathtt{spare}\)</span> and <span class="arithmatex">\(\mathtt{lastHash}\)</span> registers. This ensures loading the padding bytes at their correct positions. </p>
<p>In fact, this register will be used in the Plookup of the next state machine.</p>
<p>Observe that  <span class="arithmatex">\(\mathtt{aFreeIn}\)</span> can be computed as
$$
\mathtt{aFreeIn = (1 − (remIsZero + spare)) \cdot freeIn + remIsZero + lastHash \cdot 0x80} \tag{Eqn.12}
$$</p>
<p>Let us carefully analyse this equation;</p>
<ul>
<li>If <span class="arithmatex">\(\texttt{remIsZero}\)</span>, <span class="arithmatex">\(\texttt{spare}\)</span> and <span class="arithmatex">\(\texttt{lastHash}\)</span> are all <span class="arithmatex">\(0\)</span>, then <span class="arithmatex">\(\texttt{aFreeIn}\)</span> equals <span class="arithmatex">\(\texttt{freeIn}\)</span>. As mentioned above, at the non-padding rows, we just store <span class="arithmatex">\(\texttt{freeIn}\)</span>.</li>
<li>If <span class="arithmatex">\(\texttt{remIsZero}\)</span> is 1, <span class="arithmatex">\(\texttt{spare}\)</span> is 0 and <span class="arithmatex">\(\texttt{lastHash}\)</span> is 0, then <span class="arithmatex">\(\texttt{aFreeIn}\)</span> equals <span class="arithmatex">\(\texttt{0x01}\)</span>, which is the first byte of the padding.</li>
<li>If <span class="arithmatex">\(\texttt{remIsZero}\)</span> is 0, <span class="arithmatex">\(\texttt{spare}\)</span> is 1 and <span class="arithmatex">\(\texttt{lastHash}\)</span> is 0, then <span class="arithmatex">\(\texttt{aFreeIn}\)</span> equals <span class="arithmatex">\(\texttt{0x00}\)</span>, which are the intermediate bytes of the padding.</li>
<li>If <span class="arithmatex">\(\texttt{remIsZero}\)</span> is 0, <span class="arithmatex">\(\texttt{spare}\)</span> is 1 and <span class="arithmatex">\(\texttt{lastHash}\)</span> is 1, then <span class="arithmatex">\(\texttt{aFreeIn}\)</span> equals <span class="arithmatex">\(\texttt{0x80}\)</span>, which is the last byte of the padding.</li>
<li>Lastly, we should consider the special case where the padding is only the byte <span class="arithmatex">\(\texttt{0x81}\)</span>. In this case, <span class="arithmatex">\(\texttt{spare}\)</span> is 0 at the last row meanwhile <span class="arithmatex">\(\texttt{lastHash}\)</span> and <span class="arithmatex">\(\texttt{remIsZero}\)</span> are both 1. Therefore, <span class="arithmatex">\(\texttt{aFreeIn}\)</span> equals <span class="arithmatex">\(\texttt{0x81}\)</span>, as we wanted.</li>
</ul>
<p>See Table 4 below, for all the above cases when computing <span class="arithmatex">\(\texttt{aFreeIn}\)</span>.</p>
<div align="center"><b> Table 4 : Computation of aFreeIn cases </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|}
\hline
\texttt{remIsZero} &amp; \texttt{spare} &amp; \texttt{lastHash} &amp; \texttt{aFreeIn} \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 0 &amp; 0 &amp; \texttt{freeIn} \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; 0 &amp; 0 &amp; \texttt{0x01} \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 1 &amp; 0 &amp; \texttt{0x00} \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 1 &amp; 1 &amp; \texttt{0x80} \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; 0 &amp; 1 &amp; \texttt{0x81} \\ \hline
\end{array}
\]</div>
<h3 id="hash-output-check">Hash Output Check</h3>
<p>We have thus far only dealt with correct inputs of the padding. Now, we will introduce several columns to deal with the hash itself.</p>
<p>Since KECCAK-256's output is 256 bits long, we use eight (8) registers each of 32 bits to store the result of the hash function. Denote these registers by  <span class="arithmatex">\(\{ \mathtt{hash}_\mathtt{i}\ |\ \mathtt{i} \in \{0, 1, 2, \dots , 7\} \}\)</span>. </p>
<p>As columns, these <span class="arithmatex">\(\{\mathtt{hash}_\mathtt{i}\}\)</span> registers will remain constant within a single string, because they represent the hash of a given string. The following constraints are therefore added,
$$
\mathtt{(hash ′ −hash )·(1−lastHash) = 0} \tag{Eqn.13}
$$
A combination of other KECCAK-related state machines will be used to verify correctness of the output hash. The reason for this is that, for compatibility with the KECCAK-256 hash function, we first need to describe all inputs in terms of bits.</p>
<h3 id="length-and-read-check-operations">Length And Read Check Operations</h3>
<p>In this section we give a description of the design that will allow us to verify the lengths of input strings and the read operations.</p>
<h4 id="length-check">Length Check</h4>
<p>The length check is almost trivial because the <span class="arithmatex">\(\mathtt{len}\)</span> register has already been introduced. </p>
<p>Suppose one is given a length <span class="arithmatex">\(l\)</span> and an address <span class="arithmatex">\(a\)</span>. And the aim is to check if the string corresponding to the address <span class="arithmatex">\(a\)</span> has length <span class="arithmatex">\(l\)</span>.</p>
<p>The strategy is to use Plookup to verify that the given table contains a row with <span class="arithmatex">\(\mathtt{len} = l\)</span> and an address <span class="arithmatex">\(\mathtt{addr} = a\)</span> in the last row of the string (i.e., when <span class="arithmatex">\(\mathtt{lastHash} = 1\)</span>). That is to say, the table of columns; <span class="arithmatex">\(\mathtt{len}\)</span>, <span class="arithmatex">\(\mathtt{addr}\)</span> and <span class="arithmatex">\(\mathtt{lastHash}\)</span>; is as displayed in Table 5 below.</p>
<div align="center"><b> Table 5 : Length Check with Plookup </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|}
\hline
\texttt{lastHash} &amp; \texttt{ addr } &amp; \texttt{ len }\\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 0 &amp; \cdots \\ 
\text{ }\text{ }\text{ }\text{ }\text{ } \cdots &amp; \cdots &amp; \cdots \\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; 0 &amp; \cdots \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; 1 &amp; \cdots \\ 
\text{ }\text{ }\text{ }\text{ }\text{ } \cdots &amp; \cdots &amp; \cdots \\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; 1 &amp; \cdots \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; \cdots &amp; \cdots \\ 
\text{ }\text{ }\text{ }\text{ }\text{ } \cdots &amp; \cdots &amp; \cdots \\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; \cdots &amp; \cdots \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; a &amp; l  \\
\text{ }\text{ }\text{ }\text{ }\text{ } \cdots &amp; \cdots &amp; \cdots \\
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; a &amp; l \\ 
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 1 &amp; a &amp; l \\ \hline
\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ } 0 &amp; a+1 &amp; \cdots\\
\text{ }\text{ }\text{ }\text{ }\text{ } \cdots &amp; \cdots &amp; \cdots \\
\hline
\end{array}
\]</div>
<p>The PIL code for this Plookup looks like this:
$$
\mathtt{ hashKLen {\ addr,\ op0}\ }\quad \texttt{in} \quad 
\mathtt{ PaddingKK.lastHashLatch {\ PaddingKK.addr ,\ PaddingKK.len\ }\ }\quad
$$
where <span class="arithmatex">\(\texttt{hashKLen}\)</span> flags whenever the operation is checked and the length is stored in <span class="arithmatex">\(\mathtt{op0}\)</span>.</p>
<h4 id="read-check">Read Check</h4>
<p>Checking reads requires more columns to be introduced.</p>
<p>Recall that, given given three parameters; the address <span class="arithmatex">\(a\)</span> of a string, the position <span class="arithmatex">\(p\)</span> of the starting byte of the string, and  <span class="arithmatex">\(l\)</span>  the total number of bytes that we want to read; the intention is to read the bytes of the string from the first to thirty second.</p>
<p>It takes 8 registers, each of 32 bits, to store the output of the read operation. Let us denote these registers by 
$$
{\ \mathtt{crV_i}\ |\ \mathtt{i} \in { 0, 1, 2, \dots , 7 } }
$$
Further 8 factor polynomials <span class="arithmatex">\(\{ \mathtt{crF_j} |\ \mathtt{j} \in \{ 0, 1, 2, \dots , 7 \} \}\)</span> are needed so as to correctly place the input bytes with respect to their right power of 2. </p>
<p>Before looking into the roles of the <span class="arithmatex">\(\{\mathtt{crV_i}\}\)</span> registers and <span class="arithmatex">\(\{\mathtt{crF_i}\}\)</span> factor polynomials, three more columns are necessary for describing the verification of the read operations. These registers are; <span class="arithmatex">\(\texttt{crLen}\)</span>, <span class="arithmatex">\(\texttt{crOffset}\)</span> and <span class="arithmatex">\(\texttt{crLatch}\)</span>; and are defined as follows.</p>
<ul>
<li>
<p><span class="arithmatex">\(\mathtt{crLen}\)</span>: A register that specifies the number bytes to be read. It is a number register, containing numbers between 1 and 32, and it remains constant in each of the readings we want to perform.</p>
</li>
<li>
<p><span class="arithmatex">\(\mathtt{crOffset}\)</span>: A decreasing sequence of values, starting from <em>the length value of the read</em> minus 1 (i.e., <span class="arithmatex">\(\mathtt{crLen - 1}\)</span> ) and ends at 0, for each read. This is important for positioning each byte at the correct power of 2.</p>
</li>
<li>
<p><span class="arithmatex">\(\mathtt{crLatch}\)</span>: This is a computed column, using the same inverse technique as before. It records instances when the <span class="arithmatex">\(\mathtt{crOffset}\)</span> register is 0. First, the register <span class="arithmatex">\(\mathtt{crOffsetInv}\)</span> is committed, allowing  <span class="arithmatex">\(\mathtt{crLatch}\)</span> to be expressed as
  $$
  \mathtt{crLatch = 1 − crOffset \cdot crOffsetInv} \tag{Eqn.14}
  $$
   which satisfies the constraint, <span class="arithmatex">\(\mathtt{crOffsetInv \cdot crLatch = 0}\)</span>. </p>
</li>
</ul>
<h4 id="example-2-read-check-using-columns">Example 2. Read Check Using Columns</h4>
<p>Suppose we want to read the first 10 bytes of the address 6, and once finished, read the next two bytes of the same address thereafter. Here is the correct way of constructing the polynomials; <span class="arithmatex">\(\texttt{crLen}\)</span>, <span class="arithmatex">\(\texttt{crOffset}\)</span> and <span class="arithmatex">\(\texttt{crLatch}\)</span>. Consider the string, <span class="arithmatex">\(\mathtt{s = 0x...7355ff00111a6e6e1f02ef10}\)</span>.</p>
<div align="center"><b> Table 6 : Polynomials for a Read Check </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|}
\hline
\texttt{aFreeIn} &amp; \texttt{ addr } &amp; \texttt{ crLen } &amp; \texttt{crOffset} &amp; \texttt{crLatch}\\ \hline
\text{ }\text{ }\text{ }\mathtt{0x10} &amp; 6 &amp; 10 &amp; 9 &amp; 0 \\ 
\text{ }\text{ }\text{ }\mathtt{0xef} &amp; 6 &amp; 10 &amp; 8 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x02} &amp; 6 &amp; 10 &amp; 7 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x1f} &amp; 6 &amp; 10 &amp; 6 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x6e} &amp; 6 &amp; 10 &amp; 5 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x6e} &amp; 6 &amp; 10 &amp; 4 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x1a} &amp; 6 &amp; 10 &amp; 3 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x11} &amp; 6 &amp; 10 &amp; 2 &amp; 0\\ \hline
\text{ }\text{ }\text{ }\mathtt{0x00} &amp; 6 &amp; 10 &amp; 1 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0xff} &amp; 6 &amp; 10 &amp; 0 &amp; 1\\
\text{ }\text{ }\text{ }\mathtt{0x55} &amp; 6 &amp; 2 &amp; 1 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x73} &amp; 6 &amp; 2 &amp; 0 &amp; 1\\
\text{ }\text{ }\text{ }\text{ } \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\ \hline
\end{array}
\]</div>
<p>Note that the horinzontal line is used to separate every 8 bytes, which are the exact number of bytes stored in a <span class="arithmatex">\(\mathtt{crV_i}\)</span> register. We will later on see why this is important.</p>
<p><strong>Several Observations</strong></p>
<p>Firstly, note that <span class="arithmatex">\(\mathtt{crLatch}\)</span> is 1 <em>if and only if</em> <span class="arithmatex">\(\mathtt{crOffset}\)</span> is 0. </p>
<p>Secondly, if we want to express the two read values as an array, the output will be
$$
\mathtt{[0xff00111a6e6e1f02ef10, 0x7355]}
$$
where the first element of the array has 10 bytes, whilst the second has 2 bytes. This coincides with each of the <span class="arithmatex">\(\mathtt{crLen}\)</span> defined values.</p>
<p>Thirdly, observe the relationships that these registers; <span class="arithmatex">\(\texttt{crLen}\)</span>, <span class="arithmatex">\(\texttt{crOffset}\)</span> and <span class="arithmatex">\(\texttt{crLatch}\)</span> ; have to satisfy.</p>
<p><span class="arithmatex">\(\bf{(a)}\)</span>  The <span class="arithmatex">\(\texttt{crOffset}\)</span> register decreases in every read, so we can express this as
$$
\mathtt{crOffset′ \cdot (1 − crLatch) = (crOffset − 1) \cdot (1 − crLatch)} \tag{Eqn.15}
$$
<span class="arithmatex">\(\bf{(b)}\)</span>  The <span class="arithmatex">\(\texttt{crLen}\)</span> register remains constant during each read operation, hence the following constraint applies,
$$
\mathtt{crLen′ \cdot (1 − crLatch) = crLen \cdot (1 − crLatch)} \tag{Eqn.16}
$$
<span class="arithmatex">\(\bf{(c)}\)</span>  The first <span class="arithmatex">\(\texttt{crOffset}\)</span> of every read is <span class="arithmatex">\(\texttt{crLen − 1}\)</span>. Hence, we need to specify the following relationship
$$
\mathtt{crLatch \cdot crOffset' = crLatch \cdot (crLen′ − 1)} \tag{Eqn.17}
$$
<span class="arithmatex">\(\bf{(d)}\)</span>  In addition, we need to ensure that the address resets immediately after a string ends. Otherwise, we will read from a different string. For this reason, we need to introduce the following constraint
$$
\mathtt{(1 − crLatch) \cdot lastHash} \tag{Eqn.18}
$$
which, when combined with the previous constraints enforces the desired results.</p>
<p><strong>The registers <span class="arithmatex">\(\{\mathtt{crV_i}\}\)</span> and polynomial factors <span class="arithmatex">\(\{\mathtt{crF_i}\}\)</span></strong></p>
<p>Let us now turn to the registers <span class="arithmatex">\(\mathtt{crV_i}\)</span> and polynomial factors <span class="arithmatex">\(\mathtt{crF_i}\)</span>.</p>
<p>Consider the previous example, where the first element of the 'output' array is 
$$
\mathtt{0xff00111a6e6e1f02ef10}
$$
 Obviously, this element does not fit in a 32-bit register. So it needs to be split over three registers; <span class="arithmatex">\(\mathtt{crV_0}\)</span>, <span class="arithmatex">\(\mathtt{crV_1}\)</span> and <span class="arithmatex">\(\mathtt{crV_2}\)</span>; respectively as, 
$$
\mathtt{0x1f02ef10, 0x111a6e6e} \text{ and } \mathtt{0xff00}
$$
Moreover, each byte has a corresponding weight <span class="arithmatex">\((2^8)^j\)</span>, for some <span class="arithmatex">\(j \in \{0, 1, 2, 3\}\)</span>, such that,
$$
\mathtt{0x1f02ef10=0x10 \cdot 2^0 +0xef\cdot 2^8 +0x02\cdot 2^{16} + 0x1f\cdot2^{24}}\
\mathtt{0x111a6e6e=0x6e\cdot2^0 +0x6e\cdot2^8 +0x1a\cdot2^{16} +0x11\cdot2^{24}}\
\mathtt{0xff00=0x00\cdot2^0 +0xff\cdot2^8}\quad\quad\quad\qquad\quad\quad\quad \text{ }\text{}
$$
Henceforth, we should reflect this in our state machine using the columns <span class="arithmatex">\(\mathtt{crF_i}\)</span> and <span class="arithmatex">\(\mathtt{crV_i}\)</span> for our previous example.</p>
<div align="center"><b> Table 7 : Polynomial factors and Bytes Positioning </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|c|}
\hline
\texttt{aFreeIn} &amp; \texttt{crLatch} &amp; \mathtt{crV_0} &amp; \mathtt{crV_1} &amp; \mathtt{crV_2} &amp; \mathtt{ crF_0 } &amp; \mathtt{ crF_1 } &amp; \mathtt{ crF_2 }\\ \hline
\text{ }\text{ }\text{ }\mathtt{0x10} &amp; 0 &amp; \mathtt{0x10} &amp; \mathtt{0x00} &amp; \mathtt{0x00} &amp; 1 &amp; 0 &amp; 0 \\ 
\text{ }\text{ }\text{ }\mathtt{0xef} &amp; 0 &amp; \mathtt{0xef10} &amp; \mathtt{0x00} &amp; \mathtt{0x00} &amp; 2^8 &amp; 0 &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x02} &amp; 0 &amp; \mathtt{0x02ef10} &amp; \mathtt{0x00} &amp; \mathtt{0x00} &amp; 2^{16} &amp; 0 &amp; 0 \\
\text{ }\text{ }\text{ }\mathtt{0x1f} &amp; 0 &amp; \mathtt{0x1f02ef10} &amp; \mathtt{0x00} &amp; \mathtt{0x00} &amp; 2^{24} &amp; 0 &amp; 0 \\
\text{ }\text{ }\text{ }\mathtt{0x6e} &amp; 0 &amp; \mathtt{0x1f02ef10} &amp; \mathtt{0x6e} &amp; \mathtt{0x00} &amp; 0 &amp; 1 &amp; 0 \\
\text{ }\text{ }\text{ }\mathtt{0x6e} &amp; 0 &amp; \mathtt{0x1f02ef10} &amp; \mathtt{0x6e6e} &amp; \mathtt{0x00} &amp; 0 &amp; 2^8 &amp; 0 \\
\text{ }\text{ }\text{ }\mathtt{0x1a} &amp; 0 &amp; \mathtt{0x1f02ef10} &amp; \mathtt{0x1a6e6e} &amp; \mathtt{0x00} &amp; 0 &amp; 2^{16} &amp; 0\\
\text{ }\text{ }\text{ }\mathtt{0x11} &amp; 0 &amp; \mathtt{0x1f02ef10} &amp; \mathtt{0x111a6e6e} &amp; \mathtt{0x00} &amp; 0 &amp; 2^{24} &amp; 0\\ \hline
\text{ }\text{ }\text{ }\mathtt{0x00} &amp; 0 &amp; \mathtt{0x1f02ef10} &amp; \mathtt{0x111a6e6e} &amp; \mathtt{0x00} &amp; 0 &amp; 0 &amp; 1\\
\text{ }\text{ }\text{ }\mathtt{0xff} &amp; 1 &amp; \mathtt{0x1f02ef10} &amp; \mathtt{0x111a6e6e} &amp; \mathtt{0xff00} &amp; 0 &amp; 0 &amp; 2^8\\
\text{ }\text{ }\text{ }\mathtt{0x55} &amp; 0 &amp; \mathtt{0x55} &amp; \mathtt{0x00} &amp; \mathtt{0x00} &amp; 1 &amp; 0 &amp; 0 \\
\text{ }\text{ }\text{ }\mathtt{0x73} &amp; 1 &amp; \mathtt{0x7355} &amp; \mathtt{0x00} &amp; \mathtt{0x00} &amp; 2^8 &amp; 0 &amp; 0 \\
\text{ }\text{ }\text{ }\text{ } \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\ \hline
\end{array}
\]</div>
<p>Observe that registers <span class="arithmatex">\(\{\mathtt{crV_i}\}\)</span> are actually cumulative up to the register's maximal capacity of 4 bytes is reached, in which case the next reads are stored in the next <span class="arithmatex">\(\mathtt{crV_{i+1}}\)</span> register.</p>
<p>The registers <span class="arithmatex">\(\{\mathtt{crF_i}\}\)</span> are responsible for correct positioning of each byte with respect to powers <span class="arithmatex">\((2^8)^j\)</span>, for <span class="arithmatex">\(j \in \{0, 1, 2, 3\}\)</span>, providing the decomposition stated above.</p>
<p>Lastly, observe that the rows corresponding to <span class="arithmatex">\(\mathtt{crLatch = 1}\)</span>, store the complete result of the read in the registers <span class="arithmatex">\(\{\mathtt{crV_i}\}\)</span>. These are the rows where validity of the read operation is checked via a Plookup.</p>
<p><strong>Constraints Pertaining to <span class="arithmatex">\(\{\mathtt{crV_i}\}\)</span> and <span class="arithmatex">\(\{\mathtt{crF_i}\}\)</span> </strong></p>
<p>The idea here is to compute a column  <span class="arithmatex">\(\mathtt{crVC_i}\)</span> defined by,<br />
$$
\mathtt{crVC_i = crV_i + crF_i \cdot aFreeIn} \tag{Eqn.19}
$$
and then verify that the next state <span class="arithmatex">\(\mathtt{crV'_i}\)</span> coincides with <span class="arithmatex">\(\mathtt{crVC_i}\)</span> whenever <span class="arithmatex">\(\mathtt{crLatch}\)</span> is not equal to 1. This will confirm that the <span class="arithmatex">\(\{\mathtt{crV_i}\}\)</span> registers are not only sequentially read, but are also correctly computed from the previous states. Hence, the following constraint needs to be added;
$$
\mathtt{crV' = crVC \cdot (1 − crLatch)}  \tag{Eqn.20}
$$
So far so good. </p>
<p>Now observe that the tuple <span class="arithmatex">\((\mathtt{crOffset, crF0, crF1, . . . , crF7})\)</span> is not totally arbitrary. In fact, it needs to be checked whether <span class="arithmatex">\(\mathtt{crOffset \in \{1,\dots,32\}}\)</span> and <span class="arithmatex">\(\mathtt{crFi \in \{1,2^8,2^{16},2^{24}\}}\)</span>. This is done via a Plookup. That is, checking if the row corresponding to <span class="arithmatex">\(\mathtt{crLatch = 1}\)</span> is contained among the previously computed table of constants having all possible combinations of the previous columns.</p>
<div align="center"><b> PIL Code : Checking correct values of registers </b></div>

<div class="arithmatex">\[
\begin{aligned}
\{ \quad \text{ }\text{ }\text{ }  &amp;  \text{ }\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad \\ 
&amp; \mathtt{crOffset,}\\
&amp; \mathtt{crF0,}\\
&amp; \mathtt{crF1,}\\
&amp; \mathtt{crF2,}\\
&amp; \mathtt{crF3,}\\
&amp; \mathtt{crF4,}\\
&amp; \mathtt{crF5,}\\ 
&amp; \mathtt{crF6,}\\ 
&amp; \mathtt{crF7}\\
\quad \}\text{ }\text{ } \mathtt{in}\\
\{ \quad \text{ }\text{ }\text{} \\
&amp; \mathtt{k\_crOffset,}\\ 
&amp; \mathtt{k\_crF0,}\\ 
&amp; \mathtt{k\_crF1,}\\
&amp; \mathtt{k\_crF2,}\\
&amp; \mathtt{k\_crF3,}\\
&amp; \mathtt{k\_crF4,}\\
&amp; \mathtt{k\_crF5,}\\
&amp; \mathtt{k\_crF6,}\\
&amp; \mathtt{k\_crF7}\\
\};\quad \text{ }\text{ }\text{} \\ \hline
\end{aligned}
\]</div>
<h3 id="the-read-operation-and-the-main-state-machine">The Read Operation And The Main State Machine</h3>
<p>There are a few subtle details concerning the connection between the Read operation and the Main SM to be taken into account. </p>
<p>For instance, in order to avoid problems, reading from the last (probably smaller) block is not allowed. A constant column <span class="arithmatex">\(\mathtt{crValid}\)</span> is therefore created specifically for checking if a read is done at the last block. So, <span class="arithmatex">\(\mathtt{crValid}\)</span> will be 1 <em>if and only if</em> the current state is not at the last block. Hence, the Plookup in the Main SM's PIL code (<a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/pil/main.pil">main.pil code; lines 452 to 465</a>):</p>
<div align="center"><b> PIL Code : Validity Check for the Read operation </b></div>

<div class="arithmatex">\[
\begin{aligned}
\mathtt{hashK}\text{ } \{ &amp; \text{} \\
&amp;\texttt{addr,}\\
&amp;\texttt{HASHPOS,}\\
&amp;\texttt{DO,} \\
&amp;\texttt{op0, op1, op2, op3,}\\
&amp;\texttt{op4, op5, op6, op7}\\
\}\text{ } \mathtt{in}\quad\text{ } \\
&amp;\mathtt{PaddingKK.crLatch * PaddingKK.crValid}\text{ } \{  \\
&amp;\mathtt{PaddingKK.addr,} \\
&amp;\mathtt{PaddingKK.len - PaddingKK.rem - PaddingKK.crLen + 1,}\\
&amp;\mathtt{PaddingKK.crLen,}\\
&amp;\mathtt{PaddingKK.crVC0,\ PaddingKK.crVC1,\ PaddingKK.crVC2,\ PaddingKK.crVC3,}\\
&amp;\mathtt{PaddingKK.crVC4,\ PaddingKK.crVC5,\ PaddingKK.crVC6,\ PaddingKK.crVC7}\\
\};\qquad\text{ }\text{ }\\ \hline 
\end{aligned}
\]</div>
<p>Note that <span class="arithmatex">\(\texttt{HASHPOS}\)</span> is marking the position in the string of the byte where the reading starts. The Plookup shown above, maps the  committed polynomial <span class="arithmatex">\(\texttt{HASHPOS}\)</span> in the Main SM to the linear combination of the commited polynomials; <span class="arithmatex">\(\mathtt{len}\)</span>, <span class="arithmatex">\(\mathtt{rem}\)</span> and <span class="arithmatex">\(\mathtt{crLen}\)</span>; of the Padding-KK SM as,
$$
\mathtt{len−rem−crLen+1} \tag{Eqn.20}
$$
Let us make use of the following example to clearly see why this linear combination works. </p>
<h4 id="example-3-main-sm-and-padding-kk-connection">Example 3. Main SM and Padding-KK Connection</h4>
<p>Suppose we want to read bytes 2, 3 and 4 of the string <span class="arithmatex">\(\mathtt{0x7766554433221100}\)</span>. The table of the reading, reflecting only the relevant columns, is as follows.</p>
<div align="center"><b> Table 8 : Main SM and Padding-KK Example </b></div>

<div class="arithmatex">\[
\begin{array}{|l|c|c|c|c|c|}
\hline
\texttt{} &amp;\texttt{aFreeIn} &amp; \texttt{len} &amp;\texttt{rem} &amp;\texttt{crLen} &amp;\texttt{len - rem - crLen + 1} &amp; \mathtt{crV_1} \\ \hline
\texttt{line 0} &amp;\mathtt{0x00} &amp; 8 &amp; 8 &amp; 0 &amp; 1 &amp; \mathtt{0x00} \\ \hline
\texttt{line 1} &amp;\mathtt{0x11} &amp; 8 &amp; 7 &amp; 0 &amp; 2 &amp; \mathtt{0x00} \\ \hline
\texttt{line 2} &amp;\mathtt{0x22} &amp; 8 &amp; 6 &amp; 3 &amp; 0 &amp; \mathtt{0x22} \\ \hline
\texttt{line 3} &amp;\mathtt{0x33} &amp; 8 &amp; 5 &amp; 3 &amp; 1 &amp; \mathtt{0x3322} \\ \hline
\texttt{line 4} &amp;\mathtt{0x44} &amp; 8 &amp; 4 &amp; 3 &amp; 2 &amp; \mathtt{0x443322} \\ \hline
\texttt{line 5} &amp;\mathtt{0x55} &amp; 8 &amp; 3 &amp; 0 &amp; 6 &amp; \mathtt{0x00} \\ \hline
\texttt{line 6} &amp;\mathtt{0x66} &amp; 8 &amp; 2 &amp; 0 &amp; 7 &amp; \mathtt{0x00} \\ \hline
\texttt{line 7} &amp;\mathtt{0x77} &amp; 8 &amp; 1 &amp; 0 &amp; 8 &amp; \mathtt{0x00} \\ \hline
\end{array}
\]</div>
<p>Observe that, among the rows with <span class="arithmatex">\(\mathtt{crLen = 3}\)</span> (the ones where the reading happens), only the row in <span class="arithmatex">\(\texttt{line 6}\)</span> contains the complete read-result, <span class="arithmatex">\(\mathtt{0x443322}\)</span>, in the <span class="arithmatex">\(\mathtt{crV_i}\)</span> column. That is, although <span class="arithmatex">\(\texttt{HASHPOS = 2}\)</span>, meaning the reading starts with byte 2 which is in <span class="arithmatex">\(\texttt{line 2}\)</span>, the reading is only complete in <span class="arithmatex">\(\texttt{line 6}\)</span>. And that's the exact row where the linear combination works out to be
$$
\mathtt{\big(len−rem−crLen+1\big) = 2 = HASHPOS}
$$</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://t.me/polygonhermez" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/hermeznetwork/zkevmdoc" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hermez.io/" target="_blank" rel="noopener" title="hermez.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 3.75C0 2.784.784 2 1.75 2h20.5c.966 0 1.75.784 1.75 1.75v16.5A1.75 1.75 0 0 1 22.25 22H1.75A1.75 1.75 0 0 1 0 20.25ZM22.5 7h-21v13.25c0 .138.112.25.25.25h20.5a.25.25 0 0 0 .25-.25Zm-10-3.5v2h10V3.75a.25.25 0 0 0-.25-.25ZM7 3.5v2h4v-2Zm-5.25 0a.25.25 0 0 0-.25.25V5.5h4v-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking"], "search": "../../../../../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.6df46069.min.js"></script>
      
        <script src="../../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A description of the Poseidon State Machine.">
      
      
      
        <link rel="canonical" href="https://docs.hermez.io/zkEVM/zkProver/State-Machines/Secondary-State-Machines/Hashing/07-Poseidon-sm/">
      
      
        <link rel="prev" href="../06-KECCAK-f-sm/">
      
      
        <link rel="next" href="../../Binary/Binary/">
      
      <link rel="icon" href="../../../../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.11">
    
    
      
        <title>Poseidon State Machine - Polygon zkEVM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#poseidon-state-machine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="Polygon zkEVM Documentation" class="md-header__button md-logo" aria-label="Polygon zkEVM Documentation" data-md-component="logo">
      
  <img src="../../../../../../logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Polygon zkEVM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Poseidon State Machine
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hermeznetwork/zkevmdoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../Overview/Overview/" class="md-tabs__link md-tabs__link--active">
        Polygon zkEVM
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../Hermez_1.0/about/scalability/" class="md-tabs__link">
        Hermez 1.0
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Polygon zkEVM Documentation" class="md-nav__button md-logo" aria-label="Polygon zkEVM Documentation" data-md-component="logo">
      
  <img src="../../../../../../logo-white.svg" alt="logo">

    </a>
    Polygon zkEVM Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hermeznetwork/zkevmdoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Polygon zkEVM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Polygon zkEVM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Overview/Overview/" class="md-nav__link">
        zkEVM Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
          Basic Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Basic Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Basic-Concepts/Intro-zkProver%27s-Design-Approach/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Basic-Concepts/mFibonnaci-State-Machine-eg/" class="md-nav__link">
        Multiplicative Fibonacci SM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Basic-Concepts/A-Generic-State-Machine/" class="md-nav__link">
        A Generic State Machine
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
          zkProver
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          zkProver
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Overview/zkProver-Overview/" class="md-nav__link">
        zkProver Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2" id="__nav_1_3_2_label" tabindex="0">
          States Machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3_2">
          <span class="md-nav__icon md-icon"></span>
          States Machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Overview/zkProver-State-Machines/" class="md-nav__link">
        State Machines Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2_2" id="__nav_1_3_2_2_label" tabindex="0">
          Secondary State Machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_1_3_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3_2_2">
          <span class="md-nav__icon md-icon"></span>
          Secondary State Machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Arithmetic/Arithmetic/" class="md-nav__link">
        Arithmetic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Storage/Storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2_2_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2_2_3" id="__nav_1_3_2_2_3_label" tabindex="0">
          Hashing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_1_3_2_2_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3_2_2_3">
          <span class="md-nav__icon md-icon"></span>
          Hashing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01-Intro-SMs-for-Hashing/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02-Keccak-Framework/" class="md-nav__link">
        Keccak Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03-Padding-KK-SM/" class="md-nav__link">
        Padding-KK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04-Padding-KK-Bit-SM/" class="md-nav__link">
        Padding-KK-Bit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05-Bits2Field-SM/" class="md-nav__link">
        Bits2Field
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06-KECCAK-f-sm/" class="md-nav__link">
        Keccak-f
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Poseidon
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Poseidon
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-poseidon-hash-function" class="md-nav__link">
    The Poseidon Hash Function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#description-of-the-poseidon-sm" class="md-nav__link">
    Description Of The Poseidon SM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-a-nutshell" class="md-nav__link">
    In A Nutshell
  </a>
  
    <nav class="md-nav" aria-label="In A Nutshell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#translation-to-pil" class="md-nav__link">
    Translation To PIL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-of-poseidon-actions" class="md-nav__link">
    Execution of Poseidon Actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-poseidon-pil-program" class="md-nav__link">
    The Poseidon PIL Program
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Binary/Binary/" class="md-nav__link">
        Binary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory/Memory/" class="md-nav__link">
        Memory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory-Align/Memory-Align/" class="md-nav__link">
        Memory Align
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Complementary/Complementary/" class="md-nav__link">
        Complementary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Complementary/Configuration-File/" class="md-nav__link">
        Configuration File
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
      
      
      
        <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
          zk Tooling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          zk Tooling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1_4_1" id="__nav_1_4_1_label" tabindex="0">
          zkASM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_4_1">
          <span class="md-nav__icon md-icon"></span>
          zkASM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Basic-Syntax/" class="md-nav__link">
        Basic Syntax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Some-Examples/" class="md-nav__link">
        Some Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/zkASM/Related-Repos/" class="md-nav__link">
        Related Repositories
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_4_2" id="__nav_1_4_2_label" tabindex="0">
          PIL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_4_2">
          <span class="md-nav__icon md-icon"></span>
          PIL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Hello-World-Examples/" class="md-nav__link">
        Hello Word Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Components/" class="md-nav__link">
        Components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Cyclical-Nature/" class="md-nav__link">
        Cyclical Nature
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Modularity/" class="md-nav__link">
        Modularity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Advanced-Features/" class="md-nav__link">
        Advanced Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../zk-Tooling/PIL/Related-Repos/" class="md-nav__link">
        Related Repositories
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
      
      
      
        <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
          zkEVM Implementation How To(s)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          zkEVM Implementation How To(s)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Building-on-Polygon-zkEVM-H_io/" class="md-nav__link">
        Building on Polygon zkEVM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../How-To-Run-A-zkNode/" class="md-nav__link">
        How To Run A Local zkNode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Setting-Up-Production-zkNode/" class="md-nav__link">
        Setting Up Production zkNode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Polygon-zkEVM-Source-Code/" class="md-nav__link">
        Polygon zkEVM Source Code
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Hermez 1.0
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Hermez 1.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/scalability/" class="md-nav__link">
        Ethereum Scalability and zk-Rollups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/value-proposition/" class="md-nav__link">
        Hermez Value Proposition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/model/" class="md-nav__link">
        Hermez Network Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/about/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Users
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/hermez-wallet/" class="md-nav__link">
        Hermez Wallet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/mainnet/" class="md-nav__link">
        Hermez Mainnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/testnet/" class="md-nav__link">
        Hermez Testnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/users/exchanges/" class="md-nav__link">
        Exchanges
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/dev-guide/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
          Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3_2">
          <span class="md-nav__icon md-icon"></span>
          Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3_2_1" id="__nav_2_3_2_1_label" tabindex="0">
          Hermez zkRollup protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          Hermez zkRollup protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/hermez-protocol/protocol/" class="md-nav__link">
        Core protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/hermez-protocol/contracts/contracts/" class="md-nav__link">
        Smart contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/hermez-protocol/circuits/circuits/" class="md-nav__link">
        Circuits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/consensus/consensus/" class="md-nav__link">
        Forging consensus protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/protocol/withdrawal-delayer/withdrawal-delayer/" class="md-nav__link">
        Withdrawal delayer protocol
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/sdk/" class="md-nav__link">
        Examples/SDK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/api/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/batch-explorer/" class="md-nav__link">
        Batch Explorer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/price-updater/" class="md-nav__link">
        Hermez NodePrice Updater
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/developers/glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          FAQ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          FAQ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/end-users/" class="md-nav__link">
        End-Users
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/integrators/" class="md-nav__link">
        Integrators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/coordinators/" class="md-nav__link">
        Coordinators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/pod/" class="md-nav__link">
        Proof of Donation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../Hermez_1.0/faq/other/" class="md-nav__link">
        Other
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-poseidon-hash-function" class="md-nav__link">
    The Poseidon Hash Function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#description-of-the-poseidon-sm" class="md-nav__link">
    Description Of The Poseidon SM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-a-nutshell" class="md-nav__link">
    In A Nutshell
  </a>
  
    <nav class="md-nav" aria-label="In A Nutshell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#translation-to-pil" class="md-nav__link">
    Translation To PIL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-of-poseidon-actions" class="md-nav__link">
    Execution of Poseidon Actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-poseidon-pil-program" class="md-nav__link">
    The Poseidon PIL Program
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="poseidon-state-machine">Poseidon State Machine</h1>
<p>The Poseidon State Machine (SM) is one of the zkProver's fourteen (14) state machines. It is also a secondary state machine taking instructions from the zkProver's Main SM.  </p>
<p>It computes hash values, using the <a href="https://eprint.iacr.org/2019/458.pdf">Poseidon</a> hash function, as per instruction of the Main SM Executor, as well as requests from the Storage SM. The instructions the Poseidon SM receives, from any of the two SMs, are called <strong>Poseidon Actions</strong>. As a secondary SM, it not only executes the Poseidon Actions, but it also checks if the output hash values were correctly computed. </p>
<p>Therefore the Poseidon State Machine has the executor part (the Poseidon SM Executor) and an internal Poseidon PIL (program) which is a set of verification rules, written in the PIL language. The Poseidon SM Executor is written in two versions; Javascript and C/C++.</p>
<h2 id="the-poseidon-hash-function">The Poseidon Hash Function</h2>
<p>The Poseidon Hash, as used in the zkEVM, is defined over the Goldilocks-like field <span class="arithmatex">\(\mathbb{F}_p\)</span> where the prime <span class="arithmatex">\(p = 2^{64} - 2^{32} + 1\)</span>. It operates on <span class="arithmatex">\(\mathtt{64}\)</span>-bit field elements. The state width of the Poseidon permutation is <span class="arithmatex">\(8\)</span> field elements, which amounts to <span class="arithmatex">\(\mathtt{512}\)</span> bits, while the capacity is <span class="arithmatex">\(\mathtt{4}\)</span> field elements.</p>
<p>As a sponge construction, <span class="arithmatex">\(\text{POSEIDON}^{\pi}\)</span> has internal states each of  <span class="arithmatex">\(t\)</span>  cells (words), and iterates execution of the <strong><em>round function</em></strong> for as many times as it is regarded safe against round-dependent attacks such as Differential or Linear Cryptanalytic attacks. </p>
<p>A typical <strong><em>round function</em></strong> consists of three operations; an addition of a round-key (<span class="arithmatex">\(ARC\)</span>), a non-linear function <span class="arithmatex">\(S\)</span>  (i.e., a substitution box or S-box), and a linear function <span class="arithmatex">\(L\)</span> which is often an affine transformation (in particular, an MDS matrix <span class="arithmatex">\(M\)</span>). </p>
<p>Some rounds are <strong><em>partial rounds</em></strong> because they use only one S-box instead of the full number of  <span class="arithmatex">\(t\)</span>  S-boxes. For the specific construction given in [<a href="https://eprint.iacr.org/2019/458.pdf">GKR+20</a>], a <strong><em>full round</em></strong> means the round function utilizes  <span class="arithmatex">\(t\)</span>  instances of the same S-box. For security purposes against certain cryptanalytic attacks, outer rounds are <em>full rounds</em>, while the inner rounds are <em>partial rounds</em>. </p>
<p>Denote the number of rounds by  <span class="arithmatex">\(\mathtt{R = R_F + R_P}\)</span>  where  <span class="arithmatex">\(\mathtt{R_F}\)</span>  is the number of full rounds and  <span class="arithmatex">\(\mathtt{R_P}\)</span>  is the number of partial rounds. Also, let  <span class="arithmatex">\(\mathbf{M}(\cdot)\)</span>  denote the linear diffusion layer.</p>
<p><a href="https://eprint.iacr.org/2019/458.pdf">Figure 1</a> below, depicts a HADES-based <span class="arithmatex">\(\text{POSEIDON}^{\pi}\)</span> permutation.</p>
<p><img alt="Figure _ : POSEIDON Hash " src="../figures/01psd-hades-based-poseidon-perm.png" /></p>
<div align="center"><b> Figure 1 : Simplified HADES-based POSEIDON permutation </b></div>

<p>The Poseidon <strong>S-box</strong>, <span class="arithmatex">\(S\)</span>, is defined over a finite field as the power map  $ x \mapsto x^d $, where <span class="arithmatex">\(d \geq 3\)</span>  is chosen as the smallest integer that guarantees invertibility and provides non-linearity.</p>
<p>The commonly used S-box is the cubic, <span class="arithmatex">\(f(x) = x^3\)</span>. However, for fields where the cubic is not bijective, either  <span class="arithmatex">\(f(x) = x^5\)</span>  or  <span class="arithmatex">\(f(x) = x^{-1}\)</span>  is used as an alternative permutation.</p>
<p>The Poseidon S-box layer used in the zkProver is specified as
$$
f(x) = x^7.
$$
Maximum distance separable (<strong>MDS</strong>) matrices are used as the <strong>Linear Diffusion Layer</strong> in Poseidon, where an MDS matrix $\mathbf{M} \in \mathbb{F}^{t \times t} $ is characterised by the following known result;
$$
\text{A matrix } \mathbf{M} \text{ is an MDS matrix } \text{ iff } \text{ every submatrix of } \mathbf{M} \text{ is non-singular. }
$$
There are various ways to construct an MDS matrix. Some are secure while some are not so secure. However, algorithms <a href="&quot;Proving Resistance Against Infinitely Long Subspace Trails: How to Choose the Linear Layer&quot; https://eprint.iacr.org/2020/500.pdf">exist</a> that can be used to test whether a given MDS is secure against certain cryptanalytic attacks, such as Differential Cryptanalysis Attacks.</p>
<p>The number of full and partial rounds of the permutation, guaranteed to make Poseidon secure, is specified as follows, 
$$
\mathtt{R_F = 8 \text{ (number of full rounds) }, \quad R_P = 22 \text{ (number of partial rounds)}}
$$</p>
<p>Only one squeezing iteration is enforced, with an output of the first <span class="arithmatex">\(4\)</span> field elements of the state (which consists of approximately <span class="arithmatex">\(256\)</span>-bits, but no more than that). </p>
<h2 id="description-of-the-poseidon-sm">Description Of The Poseidon SM</h2>
<p>Poseidon SM is the most straight forward once one understands the internal mechanism of the original Poseidon hash function. The hash function's permutation process translates readily to the Poseidon SM states. </p>
<p>The Poseidon State Machine carries out Poseidon Actions in accordance with instructions from the Main SM Executor and requests from the Storage SM. That is, it computes hashes of messages sent from any of the two SMs, and also checks if the hashes were correctly computed.</p>
<p>The zkProver uses the <em>Goldilocks-like</em> Poseidon defined over the field  <span class="arithmatex">\(\mathbb{F}_p\)</span>, where  <span class="arithmatex">\(p = 2^{64} - 2^{32} + 1\)</span>.</p>
<p>The states of the Poseidon SM coincide with the twelve (12) internal states of the <span class="arithmatex">\(\text{POSEIDON}^{\pi}\)</span> permutation function. These are;  <code>in0</code>, <code>in1</code>, ... , <code>in7</code>, <code>hashType</code>, <code>cap1</code>, <code>cap2</code> and <code>cap3</code>. </p>
<p><img alt="Figure _ : POSEIDON Hash " src="../figures/02psd-poseidon-hash-pic.png" /></p>
<div align="center"><b> Figure 2 : Simplified Diagram of the POSEIDON HASH </b></div>

<p>The parameters of the <span class="arithmatex">\(\text{POSEIDON}^{\pi}\)</span> permutation are as follows; </p>
<ul>
<li>The number of internal states (or cells/words) is  <span class="arithmatex">\(t = 12\)</span>. That is, twelve  <span class="arithmatex">\(\mathbb{F}_p\)</span>  elements consisting of; the eight (8) input words <code>in0</code>, <code>in1</code>, ... , <code>in7</code>; the hash type <code>hashType</code>; and three capacity cells.</li>
<li>Capacity cells, denoted in the code as  <code>cap1</code>, <code>cap2</code> and <code>cap3</code>. That is,  <span class="arithmatex">\(c = 3\)</span>.</li>
<li>S-box used is the mapping,  <span class="arithmatex">\(f(x) = x^7\)</span>.</li>
<li>It has 8 full rounds. A <strong>full round</strong> means applying the same S-box on each of the 12 words.</li>
<li>It has 22 partial rounds. A <strong>partial round</strong> means the S-box is applied only to the first input word, <code>in0</code>.</li>
<li>The <strong>MDS</strong> matrix used is a <span class="arithmatex">\((t\times t)\)</span> Cauchy matrix, with <span class="arithmatex">\(2t + 1 \leq p\)</span>  and where each <span class="arithmatex">\((i,j)\)</span>-entry is of the form <span class="arithmatex">\(\dfrac{1}{x_i + y_i}\)</span>, where the two pairwise distinct sets <span class="arithmatex">\(\{ x_i \}\)</span> and <span class="arithmatex">\(\{ y_i \}\)</span> are defined as <code>MCIRC</code> and <code>MDIAG</code>, respectively. The linear diffusion layer is defined in lines 104 to 116 of the code <a href="https://github.com/hermeznetwork/zkproverjs/blob/main/src/sm/sm_poseidong.js">sm_poseidon.js</a>, and it is explicitly used in lines 99 to 110 of <a href="https://github.com/hermeznetwork/zkproverjs/blob/main/pil/poseidong.pil">poseidon.pil</a> code.</li>
</ul>
<p><span class="arithmatex">\(\text{POSEIDON}^{\pi}\)</span> runs 30 rounds, 3 times. Adding up to a total of 90 rounds. It outputs four (4) hash values; <code>hash0</code>, <code>hash1</code>, <code>hash2</code> and <code>hash3</code>.</p>
<p>The Poseidon MDS matrix is constructed as shown below.</p>
<pre><code class="language-js">// definition of the MDS in sm_poseidong.js


const MCIRC = [17n, 15n, 41n, 16n, 2n, 28n, 13n, 13n, 39n, 18n, 34n, 20n];
const MDIAG = [8n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n];

const M = [];
for (let i = 0; i &lt; 12; i++) {
    M[i] = [];
    for (let j = 0; j &lt; 12; j++) {
        M[i][j] = F.e(MCIRC[(-i + j + 12) % 12]);
        if (i === j) M[i][j] = F.add(M[i][j], MDIAG[i]);
    }
}

</code></pre>
<h2 id="in-a-nutshell">In A Nutshell</h2>
<p>Firstly, the Poseidon SM Executor translates the Poseidon Actions into the PIL language.</p>
<p>Secondly, it executes the Poseidon Actions (i.e., hashing). </p>
<p>And thirdly, it uses the Poseidon PIL (program) <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/pil/poseidong.pil">poseidon.pil</a>, to check execution correctness of the Poseidon Actions.</p>
<h3 id="translation-to-pil">Translation To PIL</h3>
<p>It builds the constant polynomials, which are generated once-off at the beginning. These are; </p>
<ul>
<li>Three (3) arrays of Add-Round Constants (ARCs), each an array of size 12, denoted by  <code>C[12]</code>. </li>
<li>The <code>LAST</code> constant polynomial, can either be <code>0</code> or <code>1</code>. It is used for resetting register values to <code>0</code>.</li>
<li>The <code>LATCH</code> constant polynomial, can either be <code>0</code> or <code>1</code>. </li>
<li>The <code>LASTBLOCK</code> constant polynomial, can either be <code>0</code> or <code>1</code>. It is used for resetting hash values.</li>
<li>The <code>PARTIAL</code> constant polynomial, can either be <code>0</code> or <code>1</code>. It is used to set a round to either <code>PARTIAL</code> or <code>FULL</code> round.</li>
</ul>
<h3 id="execution-of-poseidon-actions">Execution of Poseidon Actions</h3>
<p>The main part of the Poseidon SM Executor is found in the <code>lines 138 to 256</code> of <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/src/sm/sm_poseidong.js">sm_poseidong.js</a>. This is where it executes Poseidon Actions. </p>
<p>It computes all the committed polynomials;</p>
<ol>
<li>The input words;  <code>in0</code>, <code>in1</code>, ... , <code>in7</code>.  </li>
<li>The type of the hash used and the values representing the capacity ;  <code>hashType</code>, <code>cap1</code>, <code>cap2</code> and <code>cap3</code>.</li>
<li>The four hash values;  <code>hash0</code>, <code>hash1</code>, <code>hash2</code> and <code>hash3</code>, which are the outputs of the <span class="arithmatex">\(\text{POSEIDON}^{\pi}\)</span> permutation.</li>
</ol>
<p>It also exports all these committed polynomials for verification (checking the hash values  <code>hash0</code>, <code>hash1</code>, <code>hash2</code> and <code>hash3</code>), carried out by the <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/pil/poseidong.pil">poseidon.pil</a> (program).</p>
<h3 id="the-poseidon-pil-program">The Poseidon PIL Program</h3>
<p>The inputs to the Poseidon PIL (program) are; the constant polynomials and all the committed polynomials. </p>
<p>Here, the input vector  (<code>in0</code>, <code>in1</code>, ... , <code>in7</code>, <code>hashType</code>, <code>cap1</code>, <code>cap2</code>, <code>cap3</code>)  is taken through the various stages of the  <span class="arithmatex">\(\text{POSEIDON}^{\pi}\)</span> permutation;</p>
<ol>
<li>The round constants are added to each element of this input vector.</li>
<li>The S-box function is applied to each element (i.e., to the result of the addition of the round constant), where the first four (4) rounds and the last four (4) of the 30 rounds are full rounds, while the other 22 rounds are partial rounds.</li>
<li>The MDS matrix is applied to the intermediate vector, whose elements are the results of Step 2 above. </li>
<li>The final results are checked against the hash values given as input polynomial commitments; <code>hash0</code>, <code>hash1</code>, <code>hash2</code> and <code>hash3</code>.</li>
</ol>
<p>The Polygon zkEVM Repository is here: <a href="https://github.com/0xPolygonHermez">Polygon zkEVM Repo</a></p>
<p><strong>Poseidon SM Executor</strong>: <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/src/sm/sm_poseidong.js">sm_poseidong.js</a></p>
<p><strong>Poseidon SM PIL</strong>:  <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/pil/poseidong.pil">poseidong.pil</a> </p>
<p><strong>Test Vectors</strong>: <a href="https://github.com/0xPolygonHermez/zkevm-testvectors/tree/main/test/poseidon">poseidong_test.js</a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://t.me/polygonhermez" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/hermeznetwork/zkevmdoc" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hermez.io/" target="_blank" rel="noopener" title="hermez.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 3.75C0 2.784.784 2 1.75 2h20.5c.966 0 1.75.784 1.75 1.75v16.5A1.75 1.75 0 0 1 22.25 22H1.75A1.75 1.75 0 0 1 0 20.25ZM22.5 7h-21v13.25c0 .138.112.25.25.25h20.5a.25.25 0 0 0 .25-.25Zm-10-3.5v2h10V3.75a.25.25 0 0 0-.25-.25ZM7 3.5v2h4v-2Zm-5.25 0a.25.25 0 0 0-.25.25V5.5h4v-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking"], "search": "../../../../../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.6df46069.min.js"></script>
      
        <script src="../../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>